(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[6399],{946:(e,s,a)=>{"use strict";a.r(s),a.d(s,{default:()=>k});var l=a(95155),n=a(12115),i=a(34818),r=a(3998),t=a(86948),c=a(65142),d=a(76444),o=a(11186),u=a(92033),h=a(84336),x=a(13630),m=a(22452),p=a(52619),j=a.n(p),v=a(20063),f=a(58353),g=a(19708),b=a(15894),N=a(18332),w=a(1554),y=a(41048),C=a(50916);function k(){let e=(0,v.useRouter)(),{toast:s}=(0,b.dj)(),{user:a,isUserLoading:p}=(0,w.Jd)(),k=(0,w.jt)(),[F,q]=(0,n.useState)(""),[A,J]=(0,n.useState)([]),[S,P]=(0,n.useState)([{template:"",schedule:{quantity:1,unit:"days",event:"before"}}]),E=(0,w.$e)(()=>a?(0,g.rJ)(k,"users/".concat(a.uid,"/patients")):null,[k,a]),{data:L,isLoading:$}=(0,y.G)(E),_=(0,w.$e)(()=>a?(0,g.rJ)(k,"users/".concat(a.uid,"/messageTemplates")):null,[k,a]),{data:V,isLoading:D}=(0,y.G)(_),T=(0,n.useMemo)(()=>L?L.map(e=>({value:e.id,label:e.name})):[],[L]),B=(0,n.useMemo)(()=>V?V.map(e=>({value:e.id,label:e.title})):[],[V]),M=(e,s,a)=>{let l=[...S],n=l[e];if(s.includes("schedule.")){let e=s.split(".")[1];n.schedule&&(n.schedule[e]=a)}else n[s]=a;P(l)};return p||$||D?(0,l.jsx)("div",{className:"flex justify-center items-center h-full",children:(0,l.jsx)(u.A,{className:"h-8 w-8 animate-spin text-primary"})}):(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(i.z,{title:"Criar Novo Fluxo"}),(0,l.jsxs)(N.Fc,{className:"bg-blue-50 border-blue-200 text-blue-900 mb-8",children:[(0,l.jsx)(h.A,{className:"h-4 w-4 text-blue-600"}),(0,l.jsx)(N.XL,{className:"font-bold text-blue-800",children:"Dicas Importantes"}),(0,l.jsxs)(N.TN,{className:"space-y-1 mt-2",children:[(0,l.jsxs)("p",{children:["• Os fluxos s\xe3o acionados pela data em ",(0,l.jsx)("strong",{children:'"Pr\xf3xima Consulta"'})," no cadastro do paciente. Pacientes sem essa data ser\xe3o ignorados."]}),(0,l.jsx)("p",{children:'• A op\xe7\xe3o "Enviar Agora" em um fluxo existente aplicar\xe1 as regras apenas para pacientes que j\xe1 t\xeam uma pr\xf3xima consulta agendada.'}),(0,l.jsx)("p",{children:'• Se adicionar um novo paciente a um fluxo depois, voc\xea pode usar a op\xe7\xe3o "Enviar Agora" para agendar as mensagens para ele.'})]})]}),(0,l.jsxs)(t.Zp,{children:[(0,l.jsxs)(t.aR,{children:[(0,l.jsx)(t.ZB,{children:"Configura\xe7\xe3o do Fluxo"}),(0,l.jsx)(t.BT,{children:"Defina regras para enviar mensagens automaticamente."})]}),(0,l.jsxs)(t.Wu,{className:"space-y-6",children:[(0,l.jsxs)("div",{className:"space-y-2",children:[(0,l.jsx)(d.J,{htmlFor:"workflow-name",children:"Nome do Fluxo"}),(0,l.jsx)(c.p,{id:"workflow-name",placeholder:"Ex: Lembretes de Retorno",value:F,onChange:e=>q(e.target.value)})]}),(0,l.jsxs)("div",{className:"space-y-2",children:[(0,l.jsx)(d.J,{htmlFor:"patient-group",children:"Para quais pacientes?"}),(0,l.jsx)(f.K,{options:T,onValueChange:J,defaultValue:A,placeholder:"Selecione os pacientes"})]}),(0,l.jsxs)("div",{className:"space-y-4",children:[(0,l.jsx)(d.J,{children:"Passos do Fluxo"}),S.map((e,s)=>{var a,n,i;return(0,l.jsxs)("div",{className:"border p-4 rounded-lg space-y-4 relative",children:[(0,l.jsxs)("div",{className:"flex justify-between items-center",children:[(0,l.jsxs)("h4",{className:"font-semibold",children:["Passo ",s+1]}),(0,l.jsx)(r.$,{variant:"ghost",size:"icon",className:"text-muted-foreground hover:text-destructive",onClick:()=>{P(S.filter((e,a)=>a!==s))},children:(0,l.jsx)(x.A,{className:"h-4 w-4"})})]}),(0,l.jsxs)("div",{className:"space-y-2",children:[(0,l.jsx)(d.J,{htmlFor:"template-".concat(s),children:"Template"}),(0,l.jsxs)(o.l6,{value:e.template,onValueChange:e=>M(s,"template",e),children:[(0,l.jsx)(o.bq,{id:"template-".concat(s),children:(0,l.jsx)(o.yv,{placeholder:"Selecione um template"})}),(0,l.jsx)(o.gC,{children:B.map(e=>(0,l.jsx)(o.eb,{value:e.value,children:e.label},e.value))})]})]}),(0,l.jsxs)("div",{className:"space-y-2",children:[(0,l.jsx)(d.J,{children:"Quando enviar?"}),(0,l.jsxs)("div",{className:"flex items-center gap-2 flex-wrap",children:[(0,l.jsx)("span",{children:"Enviar"}),(0,l.jsx)(c.p,{type:"number",value:null==(a=e.schedule)?void 0:a.quantity,onChange:e=>M(s,"schedule.quantity",parseInt(e.target.value)),className:"w-16"}),(0,l.jsxs)(o.l6,{value:null==(n=e.schedule)?void 0:n.unit,onValueChange:e=>M(s,"schedule.unit",e),children:[(0,l.jsx)(o.bq,{className:"w-32",children:(0,l.jsx)(o.yv,{})}),(0,l.jsxs)(o.gC,{children:[(0,l.jsx)(o.eb,{value:"hours",children:"Horas"}),(0,l.jsx)(o.eb,{value:"days",children:"Dias"}),(0,l.jsx)(o.eb,{value:"weeks",children:"Semanas"}),(0,l.jsx)(o.eb,{value:"months",children:"Meses"})]})]}),(0,l.jsxs)(o.l6,{value:null==(i=e.schedule)?void 0:i.event,onValueChange:e=>M(s,"schedule.event",e),children:[(0,l.jsx)(o.bq,{className:"w-48",children:(0,l.jsx)(o.yv,{})}),(0,l.jsxs)(o.gC,{children:[(0,l.jsx)(o.eb,{value:"before",children:"Antes da consulta"}),(0,l.jsx)(o.eb,{value:"after",children:"Depois da consulta"})]})]})]})]})]},s)}),(0,l.jsxs)(r.$,{variant:"outline",className:"w-full",onClick:()=>{P([...S,{template:"",schedule:{quantity:1,unit:"days",event:"before"}}])},children:[(0,l.jsx)(m.A,{className:"mr-2 h-4 w-4"}),"Adicionar Passo"]})]})]}),(0,l.jsxs)(t.wL,{className:"flex justify-end gap-2",children:[(0,l.jsx)(r.$,{variant:"outline",asChild:!0,children:(0,l.jsx)(j(),{href:"/workflows",children:"Cancelar"})}),(0,l.jsx)(r.$,{onClick:()=>{if(!a)return;let l=(0,g.rJ)(k,"users/".concat(a.uid,"/workflows"));(0,C.BH)(l,{title:F,patients:A,steps:S,active:!0,target:"Pacientes selecionados"}),s({title:"Fluxo salvo!",description:"Seu novo fluxo de automa\xe7\xe3o foi criado."}),e.push("/workflows")},children:"Salvar Fluxo"})]})]})]})}},67595:(e,s,a)=>{Promise.resolve().then(a.bind(a,946))}},e=>{e.O(0,[2992,7138,7112,9251,1659,955,7353,531,9118,5308,4611,7356,2914,3491,7398,6117,8441,1255,7358],()=>e(e.s=67595)),_N_E=e.O()}]);