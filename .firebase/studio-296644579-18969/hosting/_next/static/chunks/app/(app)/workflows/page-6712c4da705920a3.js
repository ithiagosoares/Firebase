(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[238],{44846:(e,s,t)=>{"use strict";t.d(s,{d:()=>l});var a=t(95155),n=t(12115),r=t(27599),i=t(64269);let l=n.forwardRef((e,s)=>{let{className:t,...n}=e;return(0,a.jsx)(r.bL,{className:(0,i.cn)("peer inline-flex h-6 w-11 shrink-0 cursor-pointer items-center rounded-full border-2 border-transparent transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:ring-offset-background disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=unchecked]:bg-input",t),...n,ref:s,children:(0,a.jsx)(r.zi,{className:(0,i.cn)("pointer-events-none block h-5 w-5 rounded-full bg-background shadow-lg ring-0 transition-transform data-[state=checked]:translate-x-5 data-[state=unchecked]:translate-x-0")})})});l.displayName=r.bL.displayName},60462:(e,s,t)=>{Promise.resolve().then(t.bind(t,81295))},81295:(e,s,t)=>{"use strict";t.r(s),t.d(s,{default:()=>C});var a=t(95155),n=t(26848),r=t(22452),i=t(92033),l=t(94979),d=t(28263),o=t(74640),c=t(81288),u=t(68017),m=t(52619),x=t.n(m),h=t(34818),f=t(3998),p=t(86948),j=t(6259),g=t(44846),w=t(15894),N=t(19708),v=t(1676),b=t(15319),k=t(1554),A=t(41048),y=t(50916);function C(){let{toast:e}=(0,w.dj)(),{user:s,isUserLoading:t}=(0,k.Jd)(),m=(0,k.jt)(),C=(0,k.$e)(()=>s?(0,N.rJ)(m,"users/".concat(s.uid,"/workflows")):null,[m,s]),{data:_,isLoading:E}=(0,A.G)(C),D=(0,k.$e)(()=>s?(0,N.rJ)(m,"users/".concat(s.uid,"/patients")):null,[m,s]),{data:M,isLoading:z}=(0,A.G)(D),F=(e,s,t,a)=>{let n=(0,N.rJ)(m,"users/".concat(e,"/scheduledMessages"));a.steps.forEach(r=>{let i;i=("before"===r.schedule.event?v.j:b.W)(t,{[r.schedule.unit]:r.schedule.quantity});let l={userId:e,patientId:s,templateId:r.template,workflowId:a.id,scheduledTime:N.Dc.fromDate(i),status:"Agendado"};(0,y.BH)(n,l)})},$=async t=>{if(!s||!m||!M)return;let a=0,n=0,r=0,i=new Map(M.map(e=>[e.id,e])),l=(0,N.rJ)(m,"users/".concat(s.uid,"/scheduledMessages"));for(let e of t.patients){let d=i.get(e);if(d)if(d.nextAppointment&&d.nextAppointment.toDate()>new Date){let n=d.nextAppointment.toDate(),i=(0,N.P)(l,(0,N._M)("patientId","==",e),(0,N._M)("workflowId","==",t.id),(0,N._M)("status","==","Agendado"));(await (0,N.GG)(i)).empty?(F(s.uid,e,n,t),a++):r++}else!d.nextAppointment&&n++}a>0?e({title:"Fluxo de trabalho iniciado!",description:"Mensagens foram agendadas para ".concat(a," novo(s) paciente(s).")}):e({variant:"default",title:"Nenhum novo agendamento",description:"Nenhum paciente eleg\xedvel para novos agendamentos neste fluxo."}),r>0&&e({variant:"default",title:"Aviso de Fluxo",description:"Este fluxo j\xe1 possui mensagens agendadas para ".concat(r," paciente(s) e n\xe3o ser\xe1 reenviado.")}),n>0&&e({variant:"destructive",title:"Aviso de Dados",description:"".concat(n," paciente(s) no fluxo est\xe3o sem data de pr\xf3xima consulta e foram ignorados.")})};return E||t||z?(0,a.jsx)("div",{className:"flex justify-center items-center h-full",children:(0,a.jsx)(i.A,{className:"h-8 w-8 animate-spin text-primary"})}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(h.z,{title:"Fluxos de Automa\xe7\xe3o",children:(0,a.jsx)(f.$,{asChild:!0,children:(0,a.jsxs)(x(),{href:"/workflows/new",children:[(0,a.jsx)(r.A,{className:"mr-2 h-4 w-4"}),"Criar Fluxo"]})})}),_&&_.length>0?(0,a.jsx)("div",{className:"grid gap-6 md:grid-cols-2 lg:grid-cols-3",children:_.map(e=>(0,a.jsxs)(p.Zp,{className:"flex flex-col",children:[(0,a.jsxs)(p.aR,{children:[(0,a.jsxs)("div",{className:"flex justify-between items-start",children:[(0,a.jsx)(p.ZB,{children:e.title}),(0,a.jsx)(g.d,{checked:e.active,onCheckedChange:t=>((e,t)=>{if(!s)return;let a=(0,N.H9)(m,"users/".concat(s.uid,"/workflows/").concat(e));(0,y.wu)(a,{active:t},{merge:!0})})(e.id,t),"aria-label":"Ativar ou desativar fluxo"})]}),(0,a.jsxs)(p.BT,{children:['Enviando para "',e.target,'"']})]}),(0,a.jsxs)(p.Wu,{className:"flex-grow space-y-2",children:[(0,a.jsxs)("p",{className:"text-sm text-muted-foreground",children:["Agendamento: ",(0,a.jsx)("span",{className:"font-medium text-foreground",children:(e=>{if(!e.steps||0===e.steps.length)return"Nenhum passo";let{quantity:s,unit:t,event:a}=e.steps[0].schedule;return"".concat(s," ").concat({hours:"hora(s)",days:"dia(s)",weeks:"semana(s)",months:"m\xeas(es)"}[t]||t," ").concat("before"===a?"antes":"depois"," da consulta")})(e)})]}),(0,a.jsxs)("p",{className:"text-sm text-muted-foreground",children:["Passos: ",(0,a.jsx)("span",{className:"font-medium text-foreground",children:e.steps.length})]})]}),(0,a.jsxs)(p.wL,{className:"flex justify-between",children:[(0,a.jsxs)(f.$,{variant:"outline",size:"sm",onClick:()=>$(e),children:[(0,a.jsx)(l.A,{className:"mr-2 h-4 w-4"}),"Enviar Agora"]}),(0,a.jsxs)(j.rI,{children:[(0,a.jsx)(j.ty,{asChild:!0,children:(0,a.jsx)(f.$,{variant:"ghost",size:"icon",children:(0,a.jsx)(d.A,{className:"h-4 w-4"})})}),(0,a.jsxs)(j.SQ,{align:"end",children:[(0,a.jsx)(j.lp,{children:"A\xe7\xf5es"}),(0,a.jsx)(j.mB,{}),(0,a.jsx)(j._2,{asChild:!0,children:(0,a.jsxs)(x(),{href:"/workflows/edit/".concat(e.id),className:"flex items-center cursor-pointer",children:[(0,a.jsx)(o.A,{className:"mr-2 h-4 w-4"}),"Editar"]})}),(0,a.jsxs)(j._2,{children:[(0,a.jsx)(c.A,{className:"mr-2 h-4 w-4"}),"Duplicar"]}),(0,a.jsxs)(j._2,{onClick:()=>(e=>{if(!s)return;let t=(0,N.H9)(m,"users/".concat(s.uid,"/workflows/").concat(e));(0,y.zb)(t)})(e.id),className:"text-destructive",children:[(0,a.jsx)(u.A,{className:"mr-2 h-4 w-4"}),"Excluir"]})]})]})]})]},e.id))}):(0,a.jsx)("div",{className:"flex flex-1 items-center justify-center rounded-lg border border-dashed shadow-sm mt-8",children:(0,a.jsxs)("div",{className:"flex flex-col items-center gap-2 text-center",children:[(0,a.jsx)(n.A,{className:"h-12 w-12 text-muted-foreground"}),(0,a.jsx)("h3",{className:"text-2xl font-bold tracking-tight",children:"Nenhum fluxo de automa\xe7\xe3o criado"}),(0,a.jsx)("p",{className:"text-sm text-muted-foreground",children:"Comece a automatizar sua comunica\xe7\xe3o criando seu primeiro fluxo."}),(0,a.jsx)(f.$,{className:"mt-4",asChild:!0,children:(0,a.jsxs)(x(),{href:"/workflows/new",children:[(0,a.jsx)(r.A,{className:"mr-2 h-4 w-4"}),"Criar Fluxo"]})})]})})]})}}},e=>{e.O(0,[2992,7138,7112,9251,1659,955,7353,531,9118,5308,9082,8406,886,8441,1255,7358],()=>e(e.s=60462)),_N_E=e.O()}]);